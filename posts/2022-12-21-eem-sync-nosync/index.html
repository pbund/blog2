<!doctype html><html lang=en-us><head><title>EEM: To sync or not to sync // Grokking Cisco with Marty Bullfrog</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.109.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Paul Bundschuh"><meta name=description content><link rel=stylesheet href=/blog2/css/main.min.9e9c6027c30f5aa9423b581bd9cddd1ddc66088adb9c2604f89eb5828efea5a1.css><meta name=twitter:card content="summary"><meta name=twitter:title content="EEM: To sync or not to sync"><meta name=twitter:description content="For those of you familiar with Cisco’s EEM (Embedded Event Manager), this post will try to explain how to use the “sync” parameter in an EEM applet. It’s usage seems to confuse users, including myself sometimes. So I did some reading and testing, and here’s what I found.
Note that EEM usually requires an event detector to be specified, i.e. CLI events, syslog events, routing events, etc. The sync argument is only used with the CLI event detector."><meta property="og:title" content="EEM: To sync or not to sync"><meta property="og:description" content="For those of you familiar with Cisco’s EEM (Embedded Event Manager), this post will try to explain how to use the “sync” parameter in an EEM applet. It’s usage seems to confuse users, including myself sometimes. So I did some reading and testing, and here’s what I found.
Note that EEM usually requires an event detector to be specified, i.e. CLI events, syslog events, routing events, etc. The sync argument is only used with the CLI event detector."><meta property="og:type" content="article"><meta property="og:url" content="https://pbund.github.io/blog2/posts/2022-12-21-eem-sync-nosync/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-21T07:01:24-06:00"><meta property="article:modified_time" content="2022-12-21T07:01:24-06:00"></head><body><header class=app-header><a href=https://pbund.github.io/blog2/><img class=app-header-avatar src=/blog2/avatar.jpg alt="Paul Bundschuh"></a>
<span class=app-header-title>Grokking Cisco with Marty Bullfrog</span><p>Blogs about Cisco networking and other technical topics</p></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>EEM: To sync or not to sync</h1><div class=post-meta><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Dec 21, 2022</div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 min read</div></div></header><div class=post-content><p>For those of you familiar with Cisco’s EEM (Embedded Event Manager), this post will try to explain how to use the “sync” parameter in an EEM applet. It’s usage seems to confuse users, including myself sometimes. So I did some reading and testing, and here’s what I found.</p><p>Note that EEM usually requires an event detector to be specified, i.e. CLI events, syslog events, routing events, etc. The sync argument is only used with the CLI event detector.</p><p>As far as I can tell, synchronous mode (“sync yes”) is required <em><strong>only</strong></em> if you want to run both the EEM applet <em><strong>and</strong></em> the original CLI command, <em><strong>in that order</strong></em>. If you don’t care about the order, or don’t want to run the original CLI command, then it doesn’t matter whether you use sync mode or not.</p><p>Let’s show some examples. (These were run on a Cisco ISR 4331 running 16.9.6 code.)</p><h3 id=synchronous-mode-sync-yes>Synchronous mode (“sync yes”)</h3><p>So you want run the applet before the matched CLI command. In this example, whenever the user types the <code>show alias</code> command, you want a <code>show clock</code> to be executed first:</p><pre tabindex=0><code>Router# conf t
Enter configuration commands, one per line.  End with CNTL/Z.
Router(config)# event manager applet SyncYes   
Router(config-applet)# event cli pattern &#34;^show alias&#34; sync yes
Router(config-applet)# action 2.1 cli command &#34;enable&#34;
Router(config-applet)# action 2.3 cli command &#34;show clock&#34;
Router(config-applet)# action 2.5 puts &#34;$_cli_result&#34;
Router(config-applet)# action 9.9 set _exit_status &#34;1&#34; 
Router(config-applet)# end
Router#
Router#show alias

02:30:24.551 UTC Wed Dec 28 2022   &lt;== SHOW CLOCK EXECUTED FIRST
Router#

Exec mode aliases:                 &lt;== THEN SHOW ALIAS
  h                     help
  lo                    logout
  p                     ping
  r                     resume
  s                     show
  u                     undebug
  un                    undebug
  w                     where

Router#
</code></pre><p>Note the “sync yes” arguments added to the end of the “event cli&mldr;” command, which sets synchronous mode. (I also used a caret in front of the word “show” to only match lines beginning with “show alias”). To execute the original show alias command afterwards, you need the <code>set _exit_status “1”</code> command. Setting it to 1 executes the command. If you don’t set this variable, or set it to 0, then the command is skipped.</p><h3 id=asynchronous-mode-sync-no>Asynchronous mode (“sync no”)</h3><p>In async mode, you are required to add specify the skip parameter to indicate whether to execute the original CLI command in addition to your applet. If “skip no” is used, then both the applet and the matched CLI command will run independently (asynchronously) of each other. However, in my testing the CLI command was always executed first, then the EEM applet:</p><pre tabindex=0><code>Router#conf t
Enter configuration commands, one per line.  End with CNTL/Z.
Router(config)#no event manager applet SyncYes
Router(config)#event manager applet SyncNo    
Router(config-applet)#event cli pattern &#34;^show alias&#34; sync no skip no
Router(config-applet)# action 2.1 cli command &#34;enable&#34;
Router(config-applet)# action 2.3 cli command &#34;show clock&#34;
Router(config-applet)# action 2.5 puts &#34;$_cli_result&#34;
Router(config-applet)#end        
Router#
*Dec 28 04:14:15.609: %SYS-5-CONFIG_I: Configured from console by console
Router#
Router#sh alias
Exec mode aliases:
  h                     help
  lo                    logout
  p                     ping
  r                     resume
  s                     show
  u                     undebug
  un                    undebug
  w                     where

Router#
Dec 28 04:14:26.287: %HA_EM-6-LOG: SyncNo:  &lt;== NOW THE APPLET OCCURS AFTER
04:14:26.204 UTC Wed Dec 28 2022
Router#
</code></pre><p>You can see where I added “skip no” arguments at the end of the “event cli" line, which runs the CLI command in addition to the EEM applet. I also don’t need the <code>set _exit_status “1”</code> command anymore, since that only applies to sync mode.</p><p>If you don’t want to run the CLI command, either sync or async mode could be used. In this case I would suggest using async mode, since its commands are clearer to the user.</p><h3 id=summary>Summary</h3><ul><li>If you want to run an EEM applet <em><strong>then</strong></em> the matched CLI command, use sync mode (<code>event cli pattern “show alias” sync yes</code> and <code>set _exit_status “1”</code> lines, for example)</li><li>If you want to run an applet and the matched CLI command, in no particular order, use async mode (<code>event cli pattern “show alias” sync no skip no</code> for example). Remember this will probably run the CLI command first.</li><li>If you don’t want to run the matched CLI command at all, use either mode (although async mode is clearer, using <code>event cli pattern “show alias” sync no skip yes</code>, for example)</li></ul><p>Googling “eem sync skip” will show many good links on this subject. I recommend any article under ipspace.net – author Ivan Pepelnjak is a network stud.</p><p>Revised 12/28/22</p></div><div class=post-footer></div></article></main></body></html>